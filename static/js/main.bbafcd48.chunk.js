(this["webpackJsonpmodule-02"]=this["webpackJsonpmodule-02"]||[]).push([[0],{51:function(e,n,t){},80:function(e,n,t){},81:function(e,n,t){"use strict";t.r(n);var a=t(1),c=t.n(a),r=t(38),o=t.n(r),s=(t(51),t(15)),u=t(10),l=t.n(u),i=t(16),d=t(14),p=t(17),m=t.n(p),f=t(44),h=t(21),v=t(4),j=t(25),b=t(3);var g=function(e){var n=e.onLogin,t=Object(a.useState)(""),c=Object(d.a)(t,2),r=c[0],o=c[1],s=Object(a.useState)(""),u=Object(d.a)(s,2),l=u[0],i=u[1],p=Object(v.e)();return Object(b.jsxs)("form",{className:"loginForm",onSubmit:function(e){return function(e){e.preventDefault(),console.log("Submit"),n(r,l),p.push("/")}(e)},children:[Object(b.jsxs)("p",{children:[Object(b.jsx)("label",{htmlFor:"username",children:"Username: "}),Object(b.jsx)("input",{onChange:function(e){return o(e.target.value)},value:r,autoFocus:!0,type:"text",name:"username",id:"username",placeholder:"Username"})]}),Object(b.jsxs)("p",{children:[Object(b.jsx)("label",{htmlFor:"password",children:"Password: "}),Object(b.jsx)("input",{onChange:function(e){return i(e.target.value)},value:l,type:"password",name:"password",id:"password",placeholder:"Password"})]}),Object(b.jsxs)("p",{children:[Object(b.jsx)("button",{disabled:0===r.length||0===l.length,type:"submit",children:"Submit"})," ",Object(b.jsx)("button",{onClick:function(){p.push("/")},type:"button",children:"Cancel"})]})]})},x=function(e){var n=e.medal,t=e.country,a=e.onIncrement,r=e.onDecrement,o=e.canPatch;return Object(b.jsxs)("div",{className:"medals",children:[t[n.name].page_value!==t[n.name].saved_value?Object(b.jsxs)("span",{className:"delta",children:[n.name," Medals: ",t[n.name].page_value]}):Object(b.jsxs)("span",{children:[n.name," Medals: ",t[n.name].page_value]}),o&&Object(b.jsxs)(c.a.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return a(t.id,n.name)},children:"+"}),Object(b.jsx)("button",{disabled:0===t[n.name],onClick:function(){return r(t.id,n.name)},children:"-"})]})]})},O=function(e){var n=e.country,t=e.medals,a=e.onIncrement,r=e.onDecrement,o=e.onDelete,s=e.onSave,u=e.onReset,l=e.canDelete,i=e.canPatch;return Object(b.jsxs)("div",{className:"country",children:[Object(b.jsxs)("div",{className:"name",children:[n.name,Object(b.jsx)("span",{className:"badge",children:function(e,n){var t=0;return n.forEach((function(n){t+=e[n.name].page_value})),t}(n,t)})]}),t.map((function(e){return Object(b.jsx)(x,{country:n,medal:e,canPatch:i,onIncrement:a,onDecrement:r},e.id)})),function(){var e=!1;return t.forEach((function(t){n[t.name].page_value!==n[t.name].saved_value&&(e=!0)})),e}()?Object(b.jsxs)(c.a.Fragment,{children:[Object(b.jsx)("button",{style:{marginLeft:"8px"},onClick:function(){return s(n.id)},children:"save"}),Object(b.jsx)("button",{style:{marginLeft:"8px"},onClick:function(){return u(n.id)},children:"reset"})]}):l&&Object(b.jsx)("button",{onClick:function(){return o(n.id)},children:"delete"}),Object(b.jsx)("hr",{})]})},k=t(42),w=t(43),y=t(46),_=t(45),I=function(e){Object(y.a)(t,e);var n=Object(_.a)(t);function t(){var e;Object(k.a)(this,t);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(e=n.call.apply(n,[this].concat(c))).state={},e.handleClick=function(){var n=prompt("Enter country name");n&&n.trim().length>0&&e.props.onAdd(n)},e}return Object(w.a)(t,[{key:"render",value:function(){return Object(b.jsx)("div",{className:"newCountryButton",children:Object(b.jsx)("button",{onClick:this.handleClick,children:"New Country"})})}}]),t}(a.Component),C=(t(80),function(){var e="https://medal-api.azurewebsites.net/jwt/Api/country",n=Object(a.useState)([]),t=Object(d.a)(n,2),c=t[0],r=t[1],o=Object(a.useState)(null),u=Object(d.a)(o,2),p=u[0],x=u[1],k=Object(a.useRef)([{id:1,name:"gold"},{id:2,name:"silver"},{id:3,name:"bronze"}]),w=Object(a.useState)({name:null,canPost:!1,canPatch:!1,canDelete:!1}),y=Object(d.a)(w,2),_=y[0],C=y[1],S=Object(a.useRef)(null);S.current=c,Object(a.useEffect)((function(){function n(){return(n=Object(i.a)(l.a.mark((function n(){var t,a,c;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,m.a.get(e);case 2:t=n.sent,a=t.data,c=[],a.forEach((function(e){var n={id:e.id,name:e.name};k.current.forEach((function(t){var a=e[t.name];n[t.name]={page_value:a,saved_value:a}})),c.push(n)})),r(c);case 7:case"end":return n.stop()}}),n)})))).apply(this,arguments)}!function(){n.apply(this,arguments)}();var t=localStorage.getItem("token");t&&C(q(t));var a=(new f.a).withUrl("https://medal-api.azurewebsites.net/medalsHub").withAutomaticReconnect().build();x(a)}),[]),Object(a.useEffect)((function(){p&&p.start().then((function(){console.log("Connected!"),p.on("ReceiveAddMessage",(function(e){console.log("Add: ".concat(e.name));var n={id:e.id,name:e.name};k.current.forEach((function(t){var a=e[t.name];n[t.name]={page_value:a,saved_value:a}}));var t=Object(s.a)(S.current);t=t.concat(n),r(t)})),p.on("ReceiveDeleteMessage",(function(e){console.log("Delete id: ".concat(e));var n=Object(s.a)(S.current);n=n.filter((function(n){return n.id!==e})),r(n)})),p.on("ReceivePatchMessage",(function(e){console.log("Patch: ".concat(e.name));var n={id:e.id,name:e.name};k.current.forEach((function(t){var a=e[t.name];n[t.name]={page_value:a,saved_value:a}}));var t=Object(s.a)(S.current),a=t.findIndex((function(n){return n.id===e.id}));t[a]=n,r(t)}))})).catch((function(e){return console.log("Connection failed: ",e)}))}),[p]);var D=function(){var n=Object(i.a)(l.a.mark((function n(t){return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!M()){n.next=11;break}return n.prev=1,n.next=4,m.a.post(e,{name:t},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 4:n.next=9;break;case 6:n.prev=6,n.t0=n.catch(1),n.t0.response&&401===n.t0.response.status?alert("You are not authorized to complete this request"):n.t0.response?console.log(n.t0.response):console.log("Request failed");case 9:n.next=12;break;case 11:alert("Your token has expired");case 12:case"end":return n.stop()}}),n,null,[[1,6]])})));return function(e){return n.apply(this,arguments)}}(),P=function(){var n=Object(i.a)(l.a.mark((function n(t){var a;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!M()){n.next=13;break}return a=c,r(c.filter((function(e){return e.id!==t}))),n.prev=3,n.next=6,m.a.delete("".concat(e,"/").concat(t),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 6:n.next=11;break;case 8:n.prev=8,n.t0=n.catch(3),n.t0.response&&404===n.t0.response.status?console.log("The record does not exist - it may have already been deleted"):(r(a),n.t0.response&&401===n.t0.response.status?alert("You are not authorized to complete this request"):n.t0.response?console.log(n.t0.response):console.log("Request failed"));case 11:n.next=14;break;case 13:alert("Your token has expired");case 14:case"end":return n.stop()}}),n,null,[[3,8]])})));return function(e){return n.apply(this,arguments)}}(),E=function(){var n=Object(i.a)(l.a.mark((function n(t){var a,o,u,i,d;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a={},o=c.findIndex((function(e){return e.id===t})),u=Object(s.a)(c),i=u[o],d=[],k.current.forEach((function(e){a[e.name]=i[e.name].saved_value,i[e.name].page_value!==i[e.name].saved_value&&(d.push({op:"replace",path:e.name,value:i[e.name].page_value}),i[e.name].saved_value=i[e.name].page_value)})),console.log("json patch for id: ".concat(t,": ").concat(JSON.stringify(d))),!M()){n.next=19;break}return n.prev=8,n.next=11,m.a.patch("".concat(e,"/").concat(t),d,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 11:n.next=17;break;case 13:n.prev=13,n.t0=n.catch(8),k.current.forEach((function(e){i[e.name].page_value=a[e.name],i[e.name].saved_value=a[e.name]})),n.t0.response&&404===n.t0.response.status?console.log("The record does not exist - it may have been deleted"):n.t0.response&&401===n.t0.response.status?alert("You are not authorized to complete this request"):n.t0.response?console.log(n.t0.response):console.log("Request failed");case 17:n.next=21;break;case 19:k.current.forEach((function(e){i[e.name].page_value=a[e.name],i[e.name].saved_value=a[e.name]})),alert("Your token has expired");case 21:r(u);case 22:case"end":return n.stop()}}),n,null,[[8,13]])})));return function(e){return n.apply(this,arguments)}}(),N=function(e){var n=c.findIndex((function(n){return n.id===e})),t=Object(s.a)(c),a=t[n];k.current.forEach((function(e){a[e.name].page_value=a[e.name].saved_value})),r(t)},R=function(e,n){return L(e,n,1)},A=function(e,n){return L(e,n,-1)},L=function(e,n,t){var a=c.findIndex((function(n){return n.id===e})),o=Object(s.a)(c);o[a][n].page_value+=1*t,r(o)},z=function(){var e=Object(i.a)(l.a.mark((function e(n,t){var a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.a.post("https://medal-api.azurewebsites.net/Api/users/login",{username:n,password:t});case 3:a=e.sent,c=a.data.token,localStorage.setItem("token",c),C(q(c)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),!e.t0.response||401!==e.t0.response.status&&400!==e.t0.response.status?e.t0.response?console.log(e.t0.response):console.log("Request failed"):alert("Login failed");case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(n,t){return e.apply(this,arguments)}}(),F=function(e){return e&&e.preventDefault(),console.log("logout"),localStorage.removeItem("token"),C({name:null,canPost:!1,canPatch:!1,canDelete:!1}),!1},q=function(e){var n=Object(j.a)(e),t=Date.now()-1e3*n.exp;return t<0?(console.log("token expires in ".concat(parseInt(-1*t/6e4)," minutes")),{name:n.username,canPost:-1!==n.roles.indexOf("medals-post"),canPatch:-1!==n.roles.indexOf("medals-patch"),canDelete:-1!==n.roles.indexOf("medals-delete")}):(console.log("token expired ".concat(parseInt(t/6e4)," minutes ago")),localStorage.removeItem("token"),{name:null,canPost:!1,canPatch:!1,canDelete:!1})},M=function(){var e=localStorage.getItem("token");if(e){var n=Object(j.a)(e),t=Date.now()-1e3*n.exp;if(t<0)return console.log("token expires in ".concat(parseInt(-1*t/6e4)," minutes")),!0;console.log("token expired ".concat(parseInt(t/6e4)," minutes ago")),F()}return!1};return Object(b.jsxs)(h.a,{children:[Object(b.jsxs)("div",{className:"appHeading",children:["Olympic Medals",Object(b.jsx)("span",{className:"badge",children:function(){var e=0;return k.current.forEach((function(n){e+=c.reduce((function(e,t){return e+t[n.name].page_value}),0)})),e}()}),_.name?Object(b.jsxs)("span",{className:"logout",children:[Object(b.jsx)("a",{href:"/",onClick:F,className:"logoutLink",children:"Logout"})," [",_.name,"]"]}):Object(b.jsx)(h.b,{to:"/login",className:"loginLink",children:"Login"})]}),Object(b.jsx)(v.a,{exact:!0,path:"/login",children:Object(b.jsx)(g,{onLogin:z})}),Object(b.jsx)("div",{className:"countries",children:c.map((function(e){return Object(b.jsx)(O,{country:e,medals:k.current,canDelete:_.canDelete,canPatch:_.canPatch,onDelete:P,onSave:E,onReset:N,onIncrement:R,onDecrement:A},e.id)}))}),_.canPost&&Object(b.jsx)(I,{onAdd:D})]})}),S=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,82)).then((function(n){var t=n.getCLS,a=n.getFID,c=n.getFCP,r=n.getLCP,o=n.getTTFB;t(e),a(e),c(e),r(e),o(e)}))};o.a.render(Object(b.jsx)(c.a.StrictMode,{children:Object(b.jsx)(C,{})}),document.getElementById("root")),S()}},[[81,1,2]]]);
//# sourceMappingURL=main.bbafcd48.chunk.js.map